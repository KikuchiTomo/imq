#extend("layout"):
    #export("content"):
        <section class="space-y-6" x-data="configEditor" x-init="init()">
            <div class="glass-card p-6 space-y-3">
                <div>
                    <p class="text-xs uppercase tracking-widest text-cyan-400 font-semibold">Runtime Settings</p>
                    <h2 class="text-2xl font-bold text-white mt-2">Configuration</h2>
                </div>
                <p class="text-slate-300 text-sm">Manage IMQ core service configuration including GitHub integration, checks, and notifications.</p>
            </div>

            <template x-if="error">
                <div class="border border-red-500/40 bg-red-500/10 text-red-200 px-4 py-3 rounded-lg flex items-start gap-3">
                    <svg class="w-5 h-5 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <p x-text="error"></p>
                </div>
            </template>

            <template x-if="message">
                <div class="border border-green-500/40 bg-green-500/10 text-green-200 px-4 py-3 rounded-lg flex items-start gap-3">
                    <svg class="w-5 h-5 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <p x-text="message"></p>
                </div>
            </template>

            <!-- GitHub Integration -->
            <div class="glass-card p-6 space-y-5">
                <div class="flex items-center gap-3">
                    <svg class="w-6 h-6 text-cyan-400" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                    </svg>
                    <h3 class="text-lg font-bold text-white">GitHub Integration</h3>
                </div>

                <div class="bg-[rgba(251,191,36,0.1)] border border-yellow-500/30 rounded-lg p-4 text-sm text-yellow-200">
                    <p class="font-semibold mb-1">ðŸ”’ Security Notice</p>
                    <p>GitHub Token, API URL, and Webhook Secret must be configured via environment variables (<code>IMQ_GITHUB_TOKEN</code>, <code>IMQ_GITHUB_API_URL</code>, <code>IMQ_WEBHOOK_SECRET</code>) for security. These cannot be changed from the web UI.</p>
                </div>

                <div class="grid gap-4 sm:grid-cols-2">
                    <div class="space-y-2">
                        <label class="field-label">Integration Mode</label>
                        <select class="input" x-model="config.githubMode">
                            <option value="polling">Polling</option>
                            <option value="webhook">Webhook</option>
                        </select>
                        <p class="text-xs text-slate-400">How IMQ receives GitHub events</p>
                    </div>

                    <div class="space-y-2">
                        <label class="field-label">Polling Interval (seconds)</label>
                        <input class="input" type="number" min="10" step="5" x-model.number="config.pollingInterval">
                        <p class="text-xs text-slate-400">Minimum 10 seconds (polling mode only)</p>
                    </div>

                    <div class="space-y-2 sm:col-span-2">
                        <label class="field-label">Trigger Label</label>
                        <input class="input" type="text" placeholder="merge-queue" x-model="config.triggerLabel">
                        <p class="text-xs text-slate-400">Label that enqueues PRs automatically</p>
                    </div>
                </div>
            </div>

            <!-- Check Configurations -->
            <div class="glass-card p-6 space-y-5">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <svg class="w-6 h-6 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <h3 class="text-lg font-bold text-white">Check Configurations</h3>
                    </div>
                    <button class="btn-primary" @click="addCheck()">
                        <span class="flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                            </svg>
                            Add Check
                        </span>
                    </button>
                </div>

                <p class="text-sm text-slate-300">Define checks that must pass before merging. Each PR will run these checks in sequence or parallel based on dependencies.</p>

                <div class="space-y-3">
                    <template x-for="(check, index) in config.checks" :key="index">
                        <div class="border border-[rgba(255,255,255,0.08)] rounded-xl p-4 bg-[rgba(255,255,255,0.02)] space-y-4">
                            <div class="flex items-start justify-between gap-3">
                                <div class="flex-1 space-y-4">
                                    <div class="grid gap-4 sm:grid-cols-2">
                                        <div class="space-y-2">
                                            <label class="field-label">Check Name</label>
                                            <input class="input" type="text" placeholder="e.g., CI Tests" x-model="check.name">
                                        </div>

                                        <div class="space-y-2">
                                            <label class="field-label">Check Type</label>
                                            <select class="input" x-model="check.type">
                                                <option value="githubActions">GitHub Actions</option>
                                                <option value="localScript">Local Script</option>
                                            </select>
                                        </div>
                                    </div>

                                    <template x-if="check.type === 'githubActions'">
                                        <div class="grid gap-4 sm:grid-cols-2">
                                            <div class="space-y-2">
                                                <label class="field-label">Workflow Name</label>
                                                <input class="input" type="text" placeholder="e.g., ci.yml" x-model="check.workflowName">
                                            </div>

                                            <div class="space-y-2">
                                                <label class="field-label">Job Name (optional)</label>
                                                <input class="input" type="text" placeholder="e.g., test" x-model="check.jobName">
                                            </div>
                                        </div>
                                    </template>

                                    <template x-if="check.type === 'localScript'">
                                        <div class="grid gap-4 sm:grid-cols-2">
                                            <div class="space-y-2">
                                                <label class="field-label">Script Path</label>
                                                <input class="input" type="text" placeholder="e.g., /path/to/script.sh" x-model="check.scriptPath">
                                            </div>

                                            <div class="space-y-2">
                                                <label class="field-label">Arguments</label>
                                                <input class="input" type="text" placeholder="e.g., --flag value" x-model="check.arguments">
                                                <p class="text-xs text-slate-400">Space-separated arguments</p>
                                            </div>
                                        </div>
                                    </template>

                                    <div class="grid gap-4 sm:grid-cols-2">
                                        <div class="space-y-2">
                                            <label class="field-label">Timeout (seconds, optional)</label>
                                            <input class="input" type="number" min="0" placeholder="No timeout" x-model.number="check.timeout">
                                        </div>

                                        <div class="space-y-2">
                                            <label class="field-label">Fail Fast</label>
                                            <select class="input" x-model="check.failFast">
                                                <option value="true">Yes</option>
                                                <option value="false">No</option>
                                            </select>
                                            <p class="text-xs text-slate-400">Stop on first failure</p>
                                        </div>
                                    </div>
                                </div>

                                <button class="text-red-400 hover:text-red-300 p-2" @click="removeCheck(index)">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </template>

                    <template x-if="!config.checks || config.checks.length === 0">
                        <div class="text-center py-8 text-slate-400 border border-dashed border-[rgba(255,255,255,0.1)] rounded-xl">
                            <svg class="w-12 h-12 mx-auto mb-3 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <p>No checks configured. Click "Add Check" to create one.</p>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Notification Templates -->
            <div class="glass-card p-6 space-y-5">
                <div class="flex items-center gap-3">
                    <svg class="w-6 h-6 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                    </svg>
                    <h3 class="text-lg font-bold text-white">Notification Templates</h3>
                </div>

                <p class="text-sm text-slate-300">Customize notification messages using Markdown and template variables like <code>{{ .PRNumber }}</code>, <code>{{ .Author }}</code>, <code>{{ .Title }}</code>, <code>{{ @mention }}</code>.</p>

                <div class="space-y-4">
                    <div class="space-y-2">
                        <label class="field-label">Ready to Merge Template</label>
                        <textarea class="input h-32" placeholder="## âœ… Ready to Merge&#10;&#10;PR #{{ .PRNumber }} by @{{ .Author }} is ready to merge!&#10;&#10;{{ .Title }}&#10;&#10;cc: @team" x-model="config.notificationReadyTemplate"></textarea>
                        <p class="text-xs text-slate-400">Sent when PR is ready to merge</p>
                    </div>

                    <div class="space-y-2">
                        <label class="field-label">Check Failed Template</label>
                        <textarea class="input h-32" placeholder="## âŒ Check Failed&#10;&#10;PR #{{ .PRNumber }} by @{{ .Author }} failed checks.&#10;&#10;{{ .Title }}&#10;&#10;Failed check: {{ .FailedCheck }}&#10;&#10;cc: @{{ .Author }}" x-model="config.notificationFailedTemplate"></textarea>
                        <p class="text-xs text-slate-400">Sent when a check fails</p>
                    </div>

                    <div class="space-y-2">
                        <label class="field-label">Merged Template</label>
                        <textarea class="input h-32" placeholder="## ðŸŽ‰ Merged!&#10;&#10;PR #{{ .PRNumber }} by @{{ .Author }} has been merged.&#10;&#10;{{ .Title }}" x-model="config.notificationMergedTemplate"></textarea>
                        <p class="text-xs text-slate-400">Sent when PR is successfully merged</p>
                    </div>
                </div>

                <div class="bg-[rgba(6,182,212,0.1)] border border-cyan-500/30 rounded-lg p-4">
                    <p class="text-sm text-cyan-200 font-semibold mb-2">Available Template Variables:</p>
                    <div class="grid grid-cols-2 gap-2 text-xs text-slate-300">
                        <code class="bg-[rgba(255,255,255,0.1)] px-2 py-1 rounded">{{ "{{" }} .PRNumber {{ "}}" }}</code>
                        <code class="bg-[rgba(255,255,255,0.1)] px-2 py-1 rounded">{{ "{{" }} .Author {{ "}}" }}</code>
                        <code class="bg-[rgba(255,255,255,0.1)] px-2 py-1 rounded">{{ "{{" }} .Title {{ "}}" }}</code>
                        <code class="bg-[rgba(255,255,255,0.1)] px-2 py-1 rounded">{{ "{{" }} .Repository {{ "}}" }}</code>
                        <code class="bg-[rgba(255,255,255,0.1)] px-2 py-1 rounded">{{ "{{" }} .BaseBranch {{ "}}" }}</code>
                        <code class="bg-[rgba(255,255,255,0.1)] px-2 py-1 rounded">{{ "{{" }} .HeadBranch {{ "}}" }}</code>
                        <code class="bg-[rgba(255,255,255,0.1)] px-2 py-1 rounded">{{ "{{" }} .FailedCheck {{ "}}" }}</code>
                        <code class="bg-[rgba(255,255,255,0.1)] px-2 py-1 rounded">{{ "{{" }} @mention {{ "}}" }}</code>
                    </div>
                </div>
            </div>

            <!-- System Settings -->
            <div class="glass-card p-6 space-y-5">
                <div class="flex items-center gap-3">
                    <svg class="w-6 h-6 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                    <h3 class="text-lg font-bold text-white">System Settings</h3>
                </div>

                <div class="bg-[rgba(251,191,36,0.1)] border border-yellow-500/30 rounded-lg p-4 text-sm text-yellow-200">
                    <p class="font-semibold mb-1">ðŸ”’ Security Notice</p>
                    <p>Database configuration (<code>IMQ_DATABASE_PATH</code>, <code>IMQ_DATABASE_POOL_SIZE</code>) must be set via environment variables and cannot be changed from the web UI.</p>
                </div>

                <div class="grid gap-4 sm:grid-cols-2">
                    <div class="space-y-2">
                        <label class="field-label">Log Level</label>
                        <select class="input" x-model="config.logLevel">
                            <option value="trace">Trace</option>
                            <option value="debug">Debug</option>
                            <option value="info">Info</option>
                            <option value="warning">Warning</option>
                            <option value="error">Error</option>
                            <option value="critical">Critical</option>
                        </select>
                        <p class="text-xs text-slate-400">Logging verbosity level</p>
                    </div>

                    <div class="space-y-2">
                        <label class="field-label">Log Format</label>
                        <select class="input" x-model="config.logFormat">
                            <option value="pretty">Pretty</option>
                            <option value="json">JSON</option>
                        </select>
                        <p class="text-xs text-slate-400">Log output format</p>
                    </div>
                </div>
            </div>

            <!-- Save Button -->
            <div class="flex items-center gap-4 sticky bottom-4 bg-[rgba(15,23,42,0.95)] backdrop-blur-lg border border-[rgba(255,255,255,0.12)] rounded-xl p-4 shadow-lg">
                <button class="btn-primary flex-1 sm:flex-initial" @click="save()" :disabled="saving">
                    <svg x-show="!saving" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
                    </svg>
                    <svg x-show="saving" class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span x-text="saving ? 'Saving...' : 'Update Configuration'"></span>
                </button>

                <button class="text-slate-400 hover:text-slate-200 px-4 py-2 transition-colors" @click="reset()">
                    Reset
                </button>
            </div>
        </section>
    #endexport
#endextend
