<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>#(title) Â· IMQ GUI</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/css/app.css">
    <script>
        window.IMQ_CONFIG = {
            apiURL: "#(config.apiURL)",
            wsURL: "#(config.wsURL)",
            environment: "#(config.environment)",
            debugMode: #(config.debugMode)
        };
    </script>
    <script type="module">
        import { APIClient } from '/js/clients/APIClient.js';
        import { WebSocketClient } from '/js/clients/WebSocketClient.js';
        import { QueueService } from '/js/services/QueueService.js';
        import { createQueueStore } from '/js/stores/QueueStore.js';
        import { createConfigStore } from '/js/stores/ConfigStore.js';
        import { createDashboardComponent } from '/js/components/dashboard.js';
        import { createConfigEditor } from '/js/components/configEditor.js';

        const API_BASE_URL = window.IMQ_CONFIG?.apiURL || 'http://localhost:8080';
        const WS_URL = window.IMQ_CONFIG?.wsURL || 'ws://localhost:8080/ws/events';

        const apiClient = new APIClient(API_BASE_URL);
        const wsClient = new WebSocketClient(WS_URL, {
            reconnectInterval: 4000,
            maxReconnectAttempts: 20
        });

        const queueService = new QueueService(apiClient);
        const queueStore = createQueueStore(queueService, wsClient);
        const configStore = createConfigStore(apiClient, wsClient);

        window.queueStore = queueStore;
        window.configStore = configStore;
        window.wsClient = wsClient;
        window.createDashboardComponent = createDashboardComponent;
        window.createConfigEditor = createConfigEditor;
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" onload="
        Alpine.store('queues', window.queueStore);
        Alpine.store('config', window.configStore);
        Alpine.data('dashboard', () => window.createDashboardComponent(window.queueStore, window.wsClient));
        Alpine.data('configEditor', () => window.createConfigEditor(window.configStore));
        setTimeout(() => window.wsClient.connect(), 500);
    "></script>
</head>
<body class="min-h-screen">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">
        <header class="flex flex-col gap-6 md:flex-row md:items-start md:justify-between">
            <div class="space-y-2">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                        </svg>
                    </div>
                    <div>
                        <p class="text-xs uppercase tracking-widest text-cyan-400 font-semibold">Immediate Merge Queue</p>
                        <h1 class="text-2xl md:text-3xl font-bold text-white">Control Center</h1>
                    </div>
                </div>
            </div>
            <div class="flex flex-wrap items-center gap-2 text-xs">
                <span class="chip">
                    <span class="status-dot status-ready"></span>
                    <span class="hidden sm:inline">API:</span> #(config.apiURL)
                </span>
                <span class="chip">
                    <span class="status-dot status-checking"></span>
                    <span class="hidden sm:inline">WS:</span> #(config.wsURL)
                </span>
                <span class="chip">
                    <span class="status-dot status-pending"></span>
                    #(config.environment)
                </span>
            </div>
        </header>

        <nav class="flex gap-6 border-b border-[rgba(255,255,255,0.08)] pb-2 text-slate-200 text-sm font-semibold">
            <a href="/" class="#if(title == "Dashboard"):nav-link-active#else:text-slate-400 hover:text-slate-200#endif">
                Dashboard
            </a>
            <a href="/settings" class="#if(title == "Settings"):nav-link-active#else:text-slate-400 hover:text-slate-200#endif">
                Settings
            </a>
        </nav>

        #import("content")
    </div>
</body>
</html>
